"""
Unit and regression test for the metapredict package.

This is extremely underdone at this point... Sorry about that :'(
"""

# Import package, test suite, and other packages as needed
import metapredict
from metapredict import meta
import metapredict.backend.uniprot_predictions
from metapredict.backend.uniprot_predictions import fetch_sequence
import pytest
import sys
import os


current_filepath = os.getcwd()
fasta_filepath = "{}/input_data/testing.fasta".format(current_filepath)

def test_metapredict_imported():
    """Sample test, will always pass so long as import statement worked"""
    assert "metapredict" in sys.modules


# test the legacy metapredict predictor
def test_legacy_metapredict_predictor():
    # testing with normalization
    assert meta.predict_disorder('AERDEDNRSKEKKRNKKTNGAGDEHRDKPWSNNSTHPTHRKNEGPMHGDP', legacy=True) == [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.9979, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.9382]
    # testing without normalization
    assert meta.predict_disorder('AERDEDNRSKEKKRNKKTNGAGDEHRDKPWSNNSTHPTHRKNEGPMHGDP', normalized=False, legacy=True) == [1.0548, 1.0966, 1.0619, 1.0872, 1.0678, 1.0785, 1.0885, 1.0404, 1.0323, 1.025, 1.0061, 1.0017, 1.0072, 0.9979, 1.0325, 1.0321, 1.0389, 1.0446, 1.0608, 1.0877, 1.0933, 1.0918, 1.0955, 1.0765, 1.0584, 1.0329, 1.0343, 1.019, 1.0574, 1.1003, 1.0504, 1.0736, 1.0826, 1.0779, 1.1032, 1.0842, 1.0516, 1.0469, 1.0436, 1.0654, 1.082, 1.0712, 1.1191, 1.1262, 1.0432, 1.1303, 1.2076, 1.1519, 1.1554, 0.9382]

# test the new metapredict predictor
def test_metapredict_predictor():
    # testing with normalization
    assert meta.predict_disorder('RDCAPNNGKKMDNQQHGDVSNQSDNRDSVQQQPPQMAGSQERQKSTESQQSPRSKENKQQAGHSHPESMPRSMSEKEPEMQHDESTGMQNHNRGMQSQDP') == [0.8485, 0.9222, 0.9204, 0.9215, 0.9362, 0.9381, 0.9368, 0.9358, 0.942, 0.9427, 0.9527, 0.9565, 0.9492, 0.9492, 0.9618, 0.9609, 0.9643, 0.9605, 0.9493, 0.9719, 0.967, 0.9726, 0.9888, 0.9635, 0.9583, 0.9657, 0.9616, 0.9536, 0.9434, 0.9542, 0.9734, 0.9692, 0.955, 0.9331, 0.9353, 0.9465, 0.9584, 0.9583, 0.9759, 0.9534, 0.9703, 0.9494, 0.9667, 0.9819, 0.98, 0.9829, 0.9794, 0.9922, 0.9883, 0.9965, 1, 0.9869, 0.963, 0.9674, 0.9582, 0.9473, 0.9463, 0.9457, 0.9479, 0.9614, 0.9597, 0.9566, 0.9743, 0.9647, 0.9468, 0.9397, 0.9294, 0.93, 0.9189, 0.932, 0.9128, 0.9049, 0.8988, 0.9235, 0.9005, 0.8974, 0.8922, 0.8865, 0.8796, 0.875, 0.8879, 0.8783, 0.8754, 0.876, 0.8877, 0.8912, 0.8923, 0.8806, 0.8929, 0.8795, 0.8763, 0.8831, 0.8804, 0.8746, 0.8804, 0.9028, 0.893, 0.8656, 0.8083, 0.6598]
    # testing without normalization
    assert meta.predict_disorder('RDCAPNNGKKMDNQQHGDVSNQSDNRDSVQQQPPQMAGSQERQKSTESQQSPRSKENKQQAGHSHPESMPRSMSEKEPEMQHDESTGMQNHNRGMQSQDP', normalized=False) == [0.8485, 0.9222, 0.9204, 0.9215, 0.9362, 0.9381, 0.9368, 0.9358, 0.942, 0.9427, 0.9527, 0.9565, 0.9492, 0.9492, 0.9618, 0.9609, 0.9643, 0.9605, 0.9493, 0.9719, 0.967, 0.9726, 0.9888, 0.9635, 0.9583, 0.9657, 0.9616, 0.9536, 0.9434, 0.9542, 0.9734, 0.9692, 0.955, 0.9331, 0.9353, 0.9465, 0.9584, 0.9583, 0.9759, 0.9534, 0.9703, 0.9494, 0.9667, 0.9819, 0.98, 0.9829, 0.9794, 0.9922, 0.9883, 0.9965, 1.0048, 0.9869, 0.963, 0.9674, 0.9582, 0.9473, 0.9463, 0.9457, 0.9479, 0.9614, 0.9597, 0.9566, 0.9743, 0.9647, 0.9468, 0.9397, 0.9294, 0.93, 0.9189, 0.932, 0.9128, 0.9049, 0.8988, 0.9235, 0.9005, 0.8974, 0.8922, 0.8865, 0.8796, 0.875, 0.8879, 0.8783, 0.8754, 0.876, 0.8877, 0.8912, 0.8923, 0.8806, 0.8929, 0.8795, 0.8763, 0.8831, 0.8804, 0.8746, 0.8804, 0.9028, 0.893, 0.8656, 0.8083, 0.6598]


def test_metapredict_functions():
    # make sure the disorder domains prediction works
    testseq = 'MKAPSNGFLPSSNEGEKKPINSQLWHACAGPLVSLPPVGSLVVYFPQGHSEQVAASMQKQTDFIPNYPNLPSKLICLLHSVTLHADTETDEVYAQMTLQPVNKY'
    DisObj = meta.predict_disorder_domains(testseq, return_numpy=False)
    assert DisObj.disorder == [0.899, 0.9049, 0.9077, 0.8968, 0.8831, 0.8844, 0.874, 0.8589, 0.8449, 0.8532, 0.85, 0.8539, 0.8511, 0.8263, 0.796, 0.739, 0.6641, 0.582, 0.5121, 0.4577, 0.3952, 0.3391, 0.2939, 0.2475, 0.2076, 0.1942, 0.1901, 0.1846, 0.1683, 0.1607, 0.1606, 0.1549, 0.1462, 0.1357, 0.1333, 0.1259, 0.1142, 0.117, 0.0999, 0.0838, 0.0662, 0.0518, 0.0514, 0.071, 0.094, 0.1382, 0.1875, 0.2052, 0.2083, 0.1949, 0.1849, 0.1847, 0.1915, 0.1981, 0.2072, 0.2192, 0.2323, 0.231, 0.2447, 0.2592, 0.2552, 0.2275, 0.222, 0.2208, 0.2229, 0.2276, 0.2245, 0.224, 0.213, 0.1919, 0.1645, 0.1417, 0.12, 0.0919, 0.0577, 0.0383, 0.0389, 0.045, 0.0606, 0.0599, 0.0677, 0.0915, 0.1168, 0.1569, 0.1911, 0.1919, 0.2055, 0.1949, 0.1881, 0.1697, 0.1517, 0.1501, 0.1564, 0.1701, 0.1992, 0.2172, 0.2438, 0.2857, 0.3298, 0.3586, 0.415, 0.4355, 0.4287, 0.4115]
    
    # pytest doesn't like the np.array, so just goign to check the sum of the disorder instead.
    assert round(sum(DisObj.disorder)) == 32
    # test boundaries functionality
    assert DisObj.disordered_domain_boundaries[0] == [0, 19]
    assert DisObj.folded_domain_boundaries[0] == [19, 104]
    # test domain sequence functionality
    assert DisObj.disordered_domains == ['MKAPSNGFLPSSNEGEKKP']
    assert DisObj.folded_domains == ['INSQLWHACAGPLVSLPPVGSLVVYFPQGHSEQVAASMQKQTDFIPNYPNLPSKLICLLHSVTLHADTETDEVYAQMTLQPVNKY']
    # test return sequence functionality
    assert DisObj.sequence == 'MKAPSNGFLPSSNEGEKKPINSQLWHACAGPLVSLPPVGSLVVYFPQGHSEQVAASMQKQTDFIPNYPNLPSKLICLLHSVTLHADTETDEVYAQMTLQPVNKY'

    # make sure the uniprot preidction works
    assert meta.predict_disorder_uniprot('Q8N6T3') == [0.8977, 0.8808, 0.8288, 0.76, 0.6964, 0.6182, 0.5166, 0.4305, 0.3429, 0.2699, 0.2477, 0.2388, 0.2213, 0.2481, 0.2523, 0.3029, 0.3073, 0.3065, 0.2982, 0.2655, 0.2231, 0.1872, 0.1661, 0.1477, 0.1168, 0.0994, 0.0825, 0.0709, 0.0722, 0.0666, 0.0553, 0.059, 0.0303, 0.0239, 0.0206, 0.0165, 0.0221, 0.0197, 0.0276, 0.0216, 0.0101, 0.0077, 0.0294, 0.0465, 0.0587, 0.0717, 0.0736, 0.0702, 0.0669, 0.0563, 0.0607, 0.0521, 0.0412, 0.0315, 0.0249, 0.0233, 0.0227, 0.0225, 0.0221, 0.0405, 0.0423, 0.0439, 0.0457, 0.0467, 0.0408, 0.0368, 0.0384, 0.0376, 0.0338, 0.0317, 0.0344, 0.0405, 0.0533, 0.073, 0.096, 0.1329, 0.1557, 0.1873, 0.1961, 0.1745, 0.1454, 0.1233, 0.1029, 0.096, 0.0857, 0.0832, 0.086, 0.1201, 0.1472, 0.1591, 0.1633, 0.159, 0.138, 0.1326, 0.1065, 0.0897, 0.087, 0.0779, 0.0719, 0.0658, 0.0624, 0.0578, 0.0544, 0.0487, 0.0366, 0.0276, 0.0366, 0.0343, 0.0331, 0.0345, 0.0346, 0.0522, 0.0563, 0.0646, 0.099, 0.1193, 0.1504, 0.1963, 0.2574, 0.326, 0.3622, 0.4354, 0.488, 0.5155, 0.5949, 0.6679, 0.7152, 0.7484, 0.8124, 0.8528, 0.8748, 0.8859, 0.885, 0.882, 0.8646, 0.8395, 0.8597, 0.8784, 0.8948, 0.9012, 0.9201, 0.9081, 0.9031, 0.9109, 0.9172, 0.9312, 0.9198, 0.9163, 0.9366, 0.9318, 0.934, 0.9239, 0.9341, 0.9438, 0.9573, 0.9608, 0.972, 0.9464, 0.9396, 0.9131, 0.8843, 0.8674, 0.856, 0.8113, 0.7798, 0.7677, 0.7673, 0.7808, 0.7968, 0.8167, 0.8499, 0.8676, 0.8935, 0.9077, 0.9335, 0.9404, 0.9508, 0.9556, 0.9618, 0.9527, 0.9579, 0.9639, 0.9737, 0.9719, 0.9475, 0.9579, 0.943, 0.9214, 0.916, 0.8963, 0.8984, 0.9135, 0.93, 0.9273, 0.9296, 0.9268, 0.9206, 0.9175, 0.9134, 0.9175, 0.9236, 0.9118, 0.9097, 0.8938, 0.8997, 0.8966, 0.8929, 0.9089, 0.9294, 0.9276, 0.9388, 0.9483, 0.9512, 0.9565, 0.9609, 0.9609, 0.96, 0.9556, 0.96, 0.9603, 0.9789, 0.9724, 0.969, 0.9609, 0.9636, 0.9681, 0.9805, 0.9764, 0.9759, 0.9817, 0.9791, 0.9903, 0.9771, 0.9761, 0.9781, 0.9752, 0.9767, 0.9669, 0.9718, 0.9719, 0.9724, 0.9717, 0.9696, 0.972, 0.9567, 0.971, 0.9635, 0.9639, 0.9639, 0.9705, 0.9722, 0.9682, 0.9724, 0.9623, 0.9809, 0.983, 0.9712, 0.9679, 0.9829, 0.9863, 0.9865, 0.9811, 0.978, 0.984, 0.9852, 0.9742, 0.9639, 0.9683, 0.9696, 0.9669, 0.9617, 0.9591, 0.9695, 0.9543, 0.9544, 0.9614, 0.9518, 0.9499, 0.9607, 0.9589, 0.9572, 0.9627, 0.9588, 0.9444, 0.9471, 0.9482, 0.9512, 0.9768, 0.9634, 0.9638, 0.9539, 0.9406, 0.9348, 0.9446, 0.9445, 0.9444, 0.9551, 0.9633, 0.9524, 0.9319, 0.9336, 0.9529, 0.9568, 0.9479, 0.9509, 0.9592, 0.9728, 0.9787, 0.9647, 0.9801, 0.9763, 0.9785, 0.9725, 0.9674, 0.9699, 0.9561, 0.9712, 0.9633, 0.9655, 0.9703, 0.9674, 0.9625, 0.9686, 0.9658, 0.9684, 0.962, 0.9605, 0.9613, 0.9689, 0.9744, 0.9624, 0.9578, 0.9723, 0.9659, 0.9684, 0.9532, 0.9436, 0.9492, 0.9447, 0.953, 0.9534, 0.9561, 0.9603, 0.9466, 0.9459, 0.9494, 0.9495, 0.9629, 0.9771, 0.9926, 0.9995, 0.9962, 0.9967, 0.9941, 0.9839, 0.9774, 0.9682, 0.9623, 0.975, 0.9782, 0.9677, 0.9656, 0.9721, 0.9823, 0.9887, 0.9819, 0.9762, 0.9704, 0.9687, 0.9787, 0.9683, 0.9617, 0.9707, 0.9607, 0.9757, 0.9675, 0.971, 0.9676, 0.9655, 0.9776, 0.968, 0.9614, 0.9653, 0.9591, 0.9532, 0.9467, 0.9504, 0.9418, 0.947, 0.9597, 0.9627, 0.9499, 0.9359, 0.9501, 0.9607, 0.9304, 0.9277, 0.9253, 0.9144, 0.9173, 0.9173, 0.9191, 0.9093, 0.8939, 0.8386, 0.6994]
    # make sure the uniprot predictions with legacy predictor works
    assert meta.predict_disorder_uniprot('Q8N6T3', legacy=True) == [0.7461, 0.8075, 0.7773, 0.6604, 0.6343, 0.5719, 0.5358, 0.5232, 0.4448, 0.2933, 0.277, 0.2673, 0.2077, 0.2074, 0.1521, 0.1699, 0.1857, 0.2058, 0.246, 0.2684, 0.2435, 0.1316, 0.0503, 0.0257, 0.0486, 0.0346, 0.0427, 0.0572, 0.0538, 0.0269, 0.0508, 0.0507, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0064, 0.0185, 0.0797, 0.1116, 0.0787, 0.0639, 0.0512, 0.049, 0.0525, 0.0472, 0.0225, 0.0334, 0.0042, 0.0218, 0, 0.0143, 0.0445, 0.0499, 0.002, 0.0314, 0.0308, 0.0358, 0.0044, 0, 0, 0, 0, 0.0105, 0.0302, 0.0583, 0.1134, 0.101, 0.102, 0.1436, 0.1448, 0.1495, 0.1376, 0.1421, 0.1361, 0.1326, 0.0763, 0.1008, 0.0999, 0.0993, 0.1952, 0.2651, 0.2128, 0.1745, 0.1702, 0.1764, 0.139, 0.1222, 0.1258, 0.1025, 0.0811, 0.0818, 0.0784, 0.1059, 0.074, 0.0425, 0.0409, 0.0542, 0.0175, 0.0154, 0.0158, 0.0155, 0.0172, 0.0183, 0.0393, 0.0366, 0.0037, 0, 0.0145, 0.0861, 0.1439, 0.2164, 0.2925, 0.2934, 0.2877, 0.301, 0.3471, 0.3555, 0.4321, 0.4669, 0.5037, 0.5182, 0.5651, 0.6368, 0.6485, 0.6736, 0.7132, 0.659, 0.6539, 0.6615, 0.681, 0.6653, 0.6465, 0.6019, 0.5848, 0.4986, 0.5553, 0.5291, 0.4811, 0.4653, 0.5131, 0.5171, 0.4802, 0.495, 0.521, 0.5363, 0.5596, 0.5302, 0.5277, 0.4877, 0.5215, 0.4801, 0.4757, 0.443, 0.4216, 0.4076, 0.3912, 0.2864, 0.2768, 0.2973, 0.2187, 0.2052, 0.2378, 0.2357, 0.2415, 0.2258, 0.2866, 0.2941, 0.2695, 0.3307, 0.3516, 0.3436, 0.3678, 0.3906, 0.395, 0.4186, 0.3888, 0.4336, 0.4776, 0.52, 0.5259, 0.5714, 0.5963, 0.5975, 0.6033, 0.5707, 0.5227, 0.5016, 0.4794, 0.4371, 0.4165, 0.4024, 0.3357, 0.2171, 0.2291, 0.2229, 0.1969, 0.1583, 0.1665, 0.1864, 0.1742, 0.2009, 0.2454, 0.2547, 0.2394, 0.2797, 0.2733, 0.2351, 0.2942, 0.2866, 0.2971, 0.2742, 0.2961, 0.2954, 0.2595, 0.3305, 0.3424, 0.3362, 0.3567, 0.3718, 0.3884, 0.4263, 0.4287, 0.4781, 0.506, 0.4689, 0.5434, 0.5708, 0.572, 0.5403, 0.5672, 0.5448, 0.5262, 0.4974, 0.5204, 0.5085, 0.439, 0.4893, 0.462, 0.4672, 0.3906, 0.4254, 0.4178, 0.4187, 0.3566, 0.325, 0.3557, 0.3704, 0.3264, 0.3421, 0.3393, 0.3349, 0.299, 0.3291, 0.3296, 0.3583, 0.3612, 0.3253, 0.3233, 0.3789, 0.3753, 0.3426, 0.3729, 0.3683, 0.3809, 0.3363, 0.3927, 0.3901, 0.3392, 0.3814, 0.4111, 0.4043, 0.3815, 0.4259, 0.4532, 0.4218, 0.4609, 0.4566, 0.4381, 0.4542, 0.3508, 0.3504, 0.3366, 0.269, 0.3088, 0.3388, 0.3491, 0.4548, 0.4169, 0.4696, 0.5162, 0.5427, 0.5567, 0.5963, 0.6779, 0.6962, 0.6854, 0.7189, 0.7549, 0.7694, 0.7659, 0.761, 0.7248, 0.7056, 0.6446, 0.657, 0.6388, 0.6216, 0.5916, 0.5441, 0.5643, 0.5438, 0.4859, 0.5158, 0.5023, 0.4843, 0.4628, 0.4067, 0.4476, 0.4361, 0.4655, 0.4339, 0.4617, 0.5006, 0.53, 0.5737, 0.5361, 0.5759, 0.6379, 0.6579, 0.7218, 0.7803, 0.8186, 0.8704, 0.9146, 0.9397, 0.9649, 0.9889, 0.9727, 0.936, 0.901, 0.8342, 0.8042, 0.8271, 0.7611, 0.7243, 0.7336, 0.7403, 0.7617, 0.7777, 0.8009, 0.8014, 0.7996, 0.8116, 0.7991, 0.7851, 0.7382, 0.7285, 0.7639, 0.7281, 0.6497, 0.6453, 0.7082, 0.7399, 0.7671, 0.8231, 0.8719, 0.9108, 0.9285, 0.971, 1, 1, 1, 1, 1, 1, 1, 1, 0.9961, 0.9298, 0.8983, 0.8999, 0.9049, 0.9109, 0.9496, 0.931, 0.8694, 0.8506, 0.9301, 0.902, 0.9031, 0.887, 0.8971, 0.8025, 0.8734, 0.9135, 0.8665, 0.9367, 0.9095, 0.794]

    # make sure fetching uniprot sequence works
    assert fetch_sequence('Q8N6T3') == 'MASPRTRKVLKEVRVQDENNVCFECGAFNPQWVSVTYGIWICLECSGRHRGLGVHLSFVRSVTMDKWKDIELEKMKAGGNAKFREFLESQEDYDPCWSLQEKYNSRAAALFRDKVVALAEGREWSLESSPAQNWTPPQPRTLPSMVHRVSGQPQSVTASSDKAFEDWLNDDLGSYQGAQGNRYVGFGNTPPPQKKEDDFLNNAMSSLYSGWSSFTTGASRFASAAKEGATKFGSQASQKASELGHSLNENVLKPAQEKVKEGKIFDDVSSGVSQLASKVQGVGSKGWRDVTTFFSGKAEGPLDSPSEGHSYQNSGLDHFQNSNIDQSFWETFGSAEPTKTRKSPSSDSWTCADTSTERRSSDSWEVWGSASTNRNSNSDGGEGGEGTKKAVPPAVPTDDGWDNQNW'
    # make sure percent disorder predictions work


    expected = {0.05 : 87.4,
                0.1 : 82.5,
                0.2 : 74.9,
                0.3 : 63.5}

    # test out percent disorder using the legacy predictor
    for thresh in [0.05, 0.1, 0.2, 0.3]:
        assert round(meta.percent_disorder('MASPRTRKVLKEVRVQDENNVCFECGAFNPQWVSVTYGIWICLECSGRHRGLGVHLSFVRSVTMDKWKDIELEKMKAGGNAKFREFLESQEDYDPCWSLQEKYNSRAAALFRDKVVALAEGREWSLESSPAQNWTPPQPRTLPSMVHRVSGQPQSVTASSDKAFEDWLNDDLGSYQGAQGNRYVGFGNTPPPQKKEDDFLNNAMSSLYSGWSSFTTGASRFASAAKEGATKFGSQASQKASELGHSLNENVLKPAQEKVKEGKIFDDVSSGVSQLASKVQGVGSKGWRDVTTFFSGKAEGPLDSPSEGHSYQNSGLDHFQNSNIDQSFWETFGSAEPTKTRKSPSSDSWTCADTSTERRSSDSWEVWGSASTNRNSNSDGGEGGEGTKKAVPPAVPTDDGWDNQNW', cutoff=thresh, legacy=True), 1) == expected[thresh]

    expected = {0.05 : 90.1,
                    0.1 : 81.8,
                    0.2 : 76.1,
                    0.3 : 73.6}

    for thresh in [0.05, 0.1, 0.2, 0.3]:
             assert round(meta.percent_disorder('MASPRTRKVLKEVRVQDENNVCFECGAFNPQWVSVTYGIWICLECSGRHRGLGVHLSFVRSVTMDKWKDIELEKMKAGGNAKFREFLESQEDYDPCWSLQEKYNSRAAALFRDKVVALAEGREWSLESSPAQNWTPPQPRTLPSMVHRVSGQPQSVTASSDKAFEDWLNDDLGSYQGAQGNRYVGFGNTPPPQKKEDDFLNNAMSSLYSGWSSFTTGASRFASAAKEGATKFGSQASQKASELGHSLNENVLKPAQEKVKEGKIFDDVSSGVSQLASKVQGVGSKGWRDVTTFFSGKAEGPLDSPSEGHSYQNSGLDHFQNSNIDQSFWETFGSAEPTKTRKSPSSDSWTCADTSTERRSSDSWEVWGSASTNRNSNSDGGEGGEGTKKAVPPAVPTDDGWDNQNW', cutoff=thresh), 1) == expected[thresh]

    # make sure fasta stuff works for legacy
    assert meta.predict_disorder_fasta(fasta_filepath, legacy=True) == {'Q8N6T3': [0.7461, 0.8075, 0.7773, 0.6604, 0.6343, 0.5719, 0.5358, 0.5232, 0.4448, 0.2933, 0.277, 0.2673, 0.2077, 0.2074, 0.1521, 0.1699, 0.1857, 0.2058, 0.246, 0.2684, 0.2435, 0.1316, 0.0503, 0.0257, 0.0486, 0.0346, 0.0427, 0.0572, 0.0538, 0.0269, 0.0508, 0.0507, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0064, 0.0185, 0.0797, 0.1116, 0.0787, 0.0639, 0.0512, 0.049, 0.0525, 0.0472, 0.0225, 0.0334, 0.0042, 0.0218, 0, 0.0143, 0.0445, 0.0499, 0.002, 0.0314, 0.0308, 0.0358, 0.0044, 0, 0, 0, 0, 0.0105, 0.0302, 0.0583, 0.1134, 0.101, 0.102, 0.1436, 0.1448, 0.1495, 0.1376, 0.1421, 0.1361, 0.1326, 0.0763, 0.1008, 0.0999, 0.0993, 0.1952, 0.2651, 0.2128, 0.1745, 0.1702, 0.1764, 0.139, 0.1222, 0.1258, 0.1025, 0.0811, 0.0818, 0.0784, 0.1059, 0.074, 0.0425, 0.0409, 0.0542, 0.0175, 0.0154, 0.0158, 0.0155, 0.0172, 0.0183, 0.0393, 0.0366, 0.0037, 0, 0.0145, 0.0861, 0.1439, 0.2164, 0.2925, 0.2934, 0.2877, 0.301, 0.3471, 0.3555, 0.4321, 0.4669, 0.5037, 0.5182, 0.5651, 0.6368, 0.6485, 0.6736, 0.7132, 0.659, 0.6539, 0.6615, 0.681, 0.6653, 0.6465, 0.6019, 0.5848, 0.4986, 0.5553, 0.5291, 0.4811, 0.4653, 0.5131, 0.5171, 0.4802, 0.495, 0.521, 0.5363, 0.5596, 0.5302, 0.5277, 0.4877, 0.5215, 0.4801, 0.4757, 0.443, 0.4216, 0.4076, 0.3912, 0.2864, 0.2768, 0.2973, 0.2187, 0.2052, 0.2378, 0.2357, 0.2415, 0.2258, 0.2866, 0.2941, 0.2695, 0.3307, 0.3516, 0.3436, 0.3678, 0.3906, 0.395, 0.4186, 0.3888, 0.4336, 0.4776, 0.52, 0.5259, 0.5714, 0.5963, 0.5975, 0.6033, 0.5707, 0.5227, 0.5016, 0.4794, 0.4371, 0.4165, 0.4024, 0.3357, 0.2171, 0.2291, 0.2229, 0.1969, 0.1583, 0.1665, 0.1864, 0.1742, 0.2009, 0.2454, 0.2547, 0.2394, 0.2797, 0.2733, 0.2351, 0.2942, 0.2866, 0.2971, 0.2742, 0.2961, 0.2954, 0.2595, 0.3305, 0.3424, 0.3362, 0.3567, 0.3718, 0.3884, 0.4263, 0.4287, 0.4781, 0.506, 0.4689, 0.5434, 0.5708, 0.572, 0.5403, 0.5672, 0.5448, 0.5262, 0.4974, 0.5204, 0.5085, 0.439, 0.4893, 0.462, 0.4672, 0.3906, 0.4254, 0.4178, 0.4187, 0.3566, 0.325, 0.3557, 0.3704, 0.3264, 0.3421, 0.3393, 0.3349, 0.299, 0.3291, 0.3296, 0.3583, 0.3612, 0.3253, 0.3233, 0.3789, 0.3753, 0.3426, 0.3729, 0.3683, 0.3809, 0.3363, 0.3927, 0.3901, 0.3392, 0.3814, 0.4111, 0.4043, 0.3815, 0.4259, 0.4532, 0.4218, 0.4609, 0.4566, 0.4381, 0.4542, 0.3508, 0.3504, 0.3366, 0.269, 0.3088, 0.3388, 0.3491, 0.4548, 0.4169, 0.4696, 0.5162, 0.5427, 0.5567, 0.5963, 0.6779, 0.6962, 0.6854, 0.7189, 0.7549, 0.7694, 0.7659, 0.761, 0.7248, 0.7056, 0.6446, 0.657, 0.6388, 0.6216, 0.5916, 0.5441, 0.5643, 0.5438, 0.4859, 0.5158, 0.5023, 0.4843, 0.4628, 0.4067, 0.4476, 0.4361, 0.4655, 0.4339, 0.4617, 0.5006, 0.53, 0.5737, 0.5361, 0.5759, 0.6379, 0.6579, 0.7218, 0.7803, 0.8186, 0.8704, 0.9146, 0.9397, 0.9649, 0.9889, 0.9727, 0.936, 0.901, 0.8342, 0.8042, 0.8271, 0.7611, 0.7243, 0.7336, 0.7403, 0.7617, 0.7777, 0.8009, 0.8014, 0.7996, 0.8116, 0.7991, 0.7851, 0.7382, 0.7285, 0.7639, 0.7281, 0.6497, 0.6453, 0.7082, 0.7399, 0.7671, 0.8231, 0.8719, 0.9108, 0.9285, 0.971, 1, 1, 1, 1, 1, 1, 1, 1, 0.9961, 0.9298, 0.8983, 0.8999, 0.9049, 0.9109, 0.9496, 0.931, 0.8694, 0.8506, 0.9301, 0.902, 0.9031, 0.887, 0.8971, 0.8025, 0.8734, 0.9135, 0.8665, 0.9367, 0.9095, 0.794]}

    # make sure fasta stuff works for new predictor
    assert meta.predict_disorder_fasta(fasta_filepath, legacy=False) == {'Q8N6T3': [0.8977, 0.8808, 0.8288, 0.76, 0.6964, 0.6182, 0.5166, 0.4305, 0.3429, 0.2699, 0.2477, 0.2388, 0.2213, 0.2481, 0.2523, 0.3029, 0.3073, 0.3065, 0.2982, 0.2655, 0.2231, 0.1872, 0.1661, 0.1477, 0.1168, 0.0994, 0.0825, 0.0709, 0.0722, 0.0666, 0.0553, 0.059, 0.0303, 0.0239, 0.0206, 0.0165, 0.0221, 0.0197, 0.0276, 0.0216, 0.0101, 0.0077, 0.0294, 0.0465, 0.0587, 0.0717, 0.0736, 0.0702, 0.0669, 0.0563, 0.0607, 0.0521, 0.0412, 0.0315, 0.0249, 0.0233, 0.0227, 0.0225, 0.0221, 0.0405, 0.0423, 0.0439, 0.0457, 0.0467, 0.0408, 0.0368, 0.0384, 0.0376, 0.0338, 0.0317, 0.0344, 0.0405, 0.0533, 0.073, 0.096, 0.1329, 0.1557, 0.1873, 0.1961, 0.1745, 0.1454, 0.1233, 0.1029, 0.096, 0.0857, 0.0832, 0.086, 0.1201, 0.1472, 0.1591, 0.1633, 0.159, 0.138, 0.1326, 0.1065, 0.0897, 0.087, 0.0779, 0.0719, 0.0658, 0.0624, 0.0578, 0.0544, 0.0487, 0.0366, 0.0276, 0.0366, 0.0343, 0.0331, 0.0345, 0.0346, 0.0522, 0.0563, 0.0646, 0.099, 0.1193, 0.1504, 0.1963, 0.2574, 0.326, 0.3622, 0.4354, 0.488, 0.5155, 0.5949, 0.6679, 0.7152, 0.7484, 0.8124, 0.8528, 0.8748, 0.8859, 0.885, 0.882, 0.8646, 0.8395, 0.8597, 0.8784, 0.8948, 0.9012, 0.9201, 0.9081, 0.9031, 0.9109, 0.9172, 0.9312, 0.9198, 0.9163, 0.9366, 0.9318, 0.934, 0.9239, 0.9341, 0.9438, 0.9573, 0.9608, 0.972, 0.9464, 0.9396, 0.9131, 0.8843, 0.8674, 0.856, 0.8113, 0.7798, 0.7677, 0.7673, 0.7808, 0.7968, 0.8167, 0.8499, 0.8676, 0.8935, 0.9077, 0.9335, 0.9404, 0.9508, 0.9556, 0.9618, 0.9527, 0.9579, 0.9639, 0.9737, 0.9719, 0.9475, 0.9579, 0.943, 0.9214, 0.916, 0.8963, 0.8984, 0.9135, 0.93, 0.9273, 0.9296, 0.9268, 0.9206, 0.9175, 0.9134, 0.9175, 0.9236, 0.9118, 0.9097, 0.8938, 0.8997, 0.8966, 0.8929, 0.9089, 0.9294, 0.9276, 0.9388, 0.9483, 0.9512, 0.9565, 0.9609, 0.9609, 0.96, 0.9556, 0.96, 0.9603, 0.9789, 0.9724, 0.969, 0.9609, 0.9636, 0.9681, 0.9805, 0.9764, 0.9759, 0.9817, 0.9791, 0.9903, 0.9771, 0.9761, 0.9781, 0.9752, 0.9767, 0.9669, 0.9718, 0.9719, 0.9724, 0.9717, 0.9696, 0.972, 0.9567, 0.971, 0.9635, 0.9639, 0.9639, 0.9705, 0.9722, 0.9682, 0.9724, 0.9623, 0.9809, 0.983, 0.9712, 0.9679, 0.9829, 0.9863, 0.9865, 0.9811, 0.978, 0.984, 0.9852, 0.9742, 0.9639, 0.9683, 0.9696, 0.9669, 0.9617, 0.9591, 0.9695, 0.9543, 0.9544, 0.9614, 0.9518, 0.9499, 0.9607, 0.9589, 0.9572, 0.9627, 0.9588, 0.9444, 0.9471, 0.9482, 0.9512, 0.9768, 0.9634, 0.9638, 0.9539, 0.9406, 0.9348, 0.9446, 0.9445, 0.9444, 0.9551, 0.9633, 0.9524, 0.9319, 0.9336, 0.9529, 0.9568, 0.9479, 0.9509, 0.9592, 0.9728, 0.9787, 0.9647, 0.9801, 0.9763, 0.9785, 0.9725, 0.9674, 0.9699, 0.9561, 0.9712, 0.9633, 0.9655, 0.9703, 0.9674, 0.9625, 0.9686, 0.9658, 0.9684, 0.962, 0.9605, 0.9613, 0.9689, 0.9744, 0.9624, 0.9578, 0.9723, 0.9659, 0.9684, 0.9532, 0.9436, 0.9492, 0.9447, 0.953, 0.9534, 0.9561, 0.9603, 0.9466, 0.9459, 0.9494, 0.9495, 0.9629, 0.9771, 0.9926, 0.9995, 0.9962, 0.9967, 0.9941, 0.9839, 0.9774, 0.9682, 0.9623, 0.975, 0.9782, 0.9677, 0.9656, 0.9721, 0.9823, 0.9887, 0.9819, 0.9762, 0.9704, 0.9687, 0.9787, 0.9683, 0.9617, 0.9707, 0.9607, 0.9757, 0.9675, 0.971, 0.9676, 0.9655, 0.9776, 0.968, 0.9614, 0.9653, 0.9591, 0.9532, 0.9467, 0.9504, 0.9418, 0.947, 0.9597, 0.9627, 0.9499, 0.9359, 0.9501, 0.9607, 0.9304, 0.9277, 0.9253, 0.9144, 0.9173, 0.9173, 0.9191, 0.9093, 0.8939, 0.8386, 0.6994]}





